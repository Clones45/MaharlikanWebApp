<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>View Collections ‚Äî Maharlikan Mortuary Care Services</title>

  <!-- Global desktop theme -->
  <link rel="stylesheet" href="styles.css" />

  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script defer
    src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.4/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // ‚úÖ Supabase Init (Preserved)
    window.__SB_URL = "https://agyueadcymdopgihtckc.supabase.co";
    window.__SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFneXVlYWRjeW1kb3BnaWh0Y2tjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzMzA2NjYsImV4cCI6MjA3NDkwNjY2Nn0.EBYfJ9RTkeGLQptG3uWaOsFMIz9DySu3uhaOlzgeeMw";

    const dummyStorage = {
      getItem: () => null,
      setItem: () => { },
      removeItem: () => { },
    };

    window.SB = window.SB || supabase.createClient(window.__SB_URL, window.__SB_KEY, {
      auth: {
        persistSession: false,
        autoRefreshToken: true,
        detectSessionInUrl: false,
        storage: dummyStorage
      }
    });
  </script>

  <script src="view-collections.js" defer></script>
</head>

<body>
  <!-- Full Width Layout -->
  <div class="page" style="display: flex; flex-direction: column; height: 100vh; overflow: hidden; padding: 0;">

    <!-- Glass Header -->
    <header class="app-header glass-top"
      style="flex-shrink: 0; padding: 12px 32px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--glass-border); background: rgba(5, 5, 7, 0.6);">
      <div style="display: flex; align-items: center; gap: 20px;">
        <img src="../assets/logo-watermark.png" alt="Maharlikan"
          style="height: 50px; width: auto; filter: drop-shadow(0 0 8px rgba(34,211,238,0.4));">

        <div>
          <h1 style="font-size: 1.25rem; margin: 0; color: #fff; letter-spacing: 0.02em;">Monthly Collections</h1>
          <p class="muted" id="periodLabel" style="font-size: 0.85rem; margin: 0;">Loading period...</p>
        </div>
      </div>

      <!-- Navigation -->
      <button class="menu-btn" onclick="window.location.href='index.html'"
        style="display: flex; align-items: center; gap: 8px; padding: 10px 24px; width: auto; white-space: nowrap; height: auto;">
        <span class="icon">üè†</span> Back to Menu
      </button>
    </header>

    <!-- Main Card (Scrollable Content) -->
    <main style="flex: 1; padding: 24px 32px; overflow: hidden; display: flex; flex-direction: column;">

      <div class="card"
        style="display: flex; flex-direction: column; overflow: hidden; padding: 20px; height: 100%; border-radius: 16px; width: 100%; max-width: 100%;">

        <!-- Toolbar -->
        <div class="toolbar glass"
          style="margin-bottom: 20px; padding: 16px 24px; border-radius: 12px; flex-shrink: 0; background: rgba(255, 255, 255, 0.03);">
          <div class="filters" style="gap: 20px;">
            <div style="display:flex; align-items:center; gap:12px;">
              <span class="muted"
                style="font-size:0.85rem; text-transform:uppercase; letter-spacing:0.05em; font-weight: 600;">Period</span>
              <select id="monthSel"
                style="background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border); color: #fff; border-radius: 8px; padding: 8px 12px;"></select>
              <select id="yearSel"
                style="background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border); color: #fff; width: 90px; border-radius: 8px; padding: 8px 12px;"></select>
            </div>

            <button id="applyBtn" class="btn"
              style="padding: 0 24px; height: 42px; width: auto; display: flex; align-items: center; gap: 8px;">
              <span>üîé</span> Load Data
            </button>
          </div>

          <div class="actions" style="gap: 12px;">
            <button id="exportBtn" class="btn secondary" style="font-size: 0.9rem; padding: 0 20px; height: 42px;">
              <span>üìÑ</span> PDF
            </button>
            <button id="printBtn" class="btn tertiary" style="font-size: 0.9rem; padding: 0 20px; height: 42px;">
              <span>üñ®</span> Print
            </button>
          </div>
        </div>

        <!-- Enhanced Crystal Table -->
        <div class="table-wrap"
          style="flex: 1; margin-top: 0; border: 0; background: transparent; backdrop-filter: none; box-shadow: none;">
          <table id="collectionsTable">
            <thead>
              <tr>
                <th>Date</th>
                <th style="width: 80px;">AF No</th>
                <th>Last Name</th>
                <th>First Name</th>
                <th>Address</th>
                <th>PACKAGE TYPE</th>
                <th>OR #</th>
                <th class="right">Amount</th>
                <th>Type</th>
                <th>Collector</th>
              </tr>
            </thead>
            <tbody id="tbody">
              <tr>
                <td colspan="10" class="muted" style="text-align:center; padding: 60px;">
                  <div style="font-size: 1.1rem; margin-bottom: 8px; color: var(--text-main);">Select a period to view
                    collections</div>
                  <div style="font-size: 0.9rem; opacity: 0.6;">Use the toolbar above to filter data</div>
                </td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <th colspan="6" class="right"
                  style="text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.85rem; color: var(--text-muted);">
                  Total Collected</th>
                <th class="right sum" id="totalCell" style="font-size: 1.25rem; color: var(--neon-accent);">0.00</th>
                <th colspan="2"></th>
              </tr>
            </tfoot>
          </table>
        </div>

      </div>
    </main>
  </div>
</body>

</html>