<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Add Collection ‚Äî Maharlikan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --bg: #0b0e14;
      --card: #171b22;
      --muted: #9aa7b7;
      --text: #e8eef7;
      --accent: #4a78ff;
      --accent-2: #2a3240;
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      background: var(--bg) center/cover no-repeat;
      color: var(--text);
      font: 16px/1.45 system-ui, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial;
    }

    .page {
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 24px
    }

    .card {
      width: min(720px, calc(100vw - 32px));
      background: linear-gradient(180deg, #1b2028, #141820);
      border: 1px solid #272c36;
      border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, .35);
      padding: 22px 22px 16px;
      position: relative;
    }

    .title {
      margin: 6px 6px 14px;
      text-align: center;
      font-weight: 700;
      letter-spacing: .2px
    }

    .home-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      background: var(--accent);
      color: #fff;
      border: 0;
      border-radius: 8px;
      padding: 6px 12px;
      font-weight: 600;
      cursor: pointer;
      transition: filter .2s ease;
    }

    .home-btn:hover {
      filter: brightness(0.95)
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin: 8px 6px 6px
    }

    input,
    select {
      width: 100%;
      box-sizing: border-box;
      padding: 12px 12px;
      color: var(--text);
      background: #0f131b;
      border: 1px solid #2a3140;
      border-radius: 10px;
      outline: none;
    }

    input:focus,
    select:focus {
      border-color: #6f97ff;
      box-shadow: 0 0 0 2px #2440aa33
    }

    .row.two {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px
    }

    .row.three {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px
    }

    .info {
      margin: 12px 6px 6px;
      padding: 12px;
      min-height: 52px;
      border: 1px dashed #2c3445;
      border-radius: 10px;
      background: #0e1219;
      color: #cfd6e4;
      white-space: pre-line;
    }

    .actions {
      display: flex;
      gap: 10px;
      margin: 10px 6px 6px
    }

    .btn {
      flex: 1;
      appearance: none;
      border: 1px solid #2c3445;
      background: #141a24;
      color: var(--text);
      padding: 12px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn.primary {
      background: var(--accent);
      border-color: #4669ff;
      color: #eef2ff
    }

    .btn.ghost {
      background: #0e1219
    }

    .btn:disabled {
      opacity: .6;
      cursor: not-allowed
    }

    .muted {
      color: var(--muted)
    }

    .toast {
      position: fixed;
      left: 50%;
      top: 24px;
      transform: translateX(-50%);
      background: #1b2333;
      border: 1px solid #2c3548;
      color: #eef3ff;
      padding: 12px 16px;
      border-radius: 10px;
      box-shadow: 0 8px 28px rgba(0, 0, 0, .35);
      opacity: 0;
      pointer-events: none;
      transition: opacity .24s ease, transform .24s ease;
      z-index: 9999;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(4px)
    }

    .tip {
      background: #101521;
      border: 1px solid #2b3242;
      border-radius: 10px;
      color: #eaefff;
      font-size: 13px;
      padding: 10px 12px;
      margin: 0 0 12px;
    }

    .note {
      margin: 6px 6px 0;
      font-size: 12px;
      color: #9fb2d1;
    }

    /* ---------- Checkbox row alignment fix ---------- */
    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 18px;
      flex-wrap: wrap;
      margin: 10px 6px 0;
    }

    .checkbox-row label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--muted);
      cursor: pointer;
    }

    .checkbox-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #00ce33;
      cursor: pointer;
    }

    .installment-note {
      margin: 4px 6px 8px;
      font-size: 12px;
      color: #9fb2d1;
    }

    @media (max-width: 480px) {
      .checkbox-row {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="card">
      <button class="home-btn" onclick="window.location.href='index.html'">üè† Home</button>
      <h1 class="title">Add Collection</h1>

      <div class="tip">
        üí° <b>Tip:</b> Choose <b>Payment For</b>. If you select <b>Membership Fee</b>, the Amount will auto-set to
        <b>‚Ç±500.00</b>:<br>
        ‚Ä¢ <i>Deduct checked</i> ‚Üí Agent takes ‚Ç±150 outright now (Gross ‚Ç±500 is still recorded).<br>
        ‚Ä¢ <i>Deduct unchecked</i> ‚Üí Full ‚Ç±500 is collected (‚Ç±150 added to agent‚Äôs monthly commission).
      </div>

      <form id="collectForm" autocomplete="off">
        <div class="row three">
          <div>
            <label for="maf_no">AF No</label>
            <input id="maf_no" name="maf_no" type="text" placeholder="Enter AF/MAF number" required />
          </div>
          <div>
            <label for="amount">Amount Paid</label>
            <input id="amount" name="amount" type="number" min="0" step="0.01" placeholder="0.00" required />
            <div id="amountNote" class="note" style="display:none;"></div>
          </div>
          <div>
            <label for="date_paid">Date Paid</label>
            <input id="date_paid" name="date_paid" type="date" required />
          </div>
        </div>

        <!-- NEW ROW: OR Number + Payment Type + Collector -->
        <div class="row three">
          <div>
            <label for="or_no">OR No.</label>
            <input id="or_no" name="or_no" type="text" placeholder="Enter OR / Receipt No." />
          </div>
          <div>
            <label for="payment_for">Payment For</label>
            <select id="payment_for" name="payment_for">
              <option value="regular">Regular / Monthly</option>
              <option value="membership">Membership Fee</option>
            </select>
          </div>
          <div>
            <label for="collector_id">Collector</label>
            <select id="collector_id" name="collector_id">
              <option value="">‚Äî Same as Agent ‚Äî</option>
              <option disabled>Loading...</option>
            </select>
          </div>
        </div>

        <!-- MEMBERSHIP DEDUCT MODE -->
        <div class="checkbox-row single">
          <label>
            <input id="deduct_now" type="checkbox" />
            Agent deducts ‚Ç±150 outright commission now (Deduct mode)
          </label>
        </div>

        <!-- NEW SECTION: COMMISSION CHECKBOXES -->
        <div class="checkbox-row" id="commissionChecks" style="display:none;">
          <label><input id="monthly_commission_given" type="checkbox"> Monthly / Deferred Commission</label>
          <label><input id="travel_allowance_given" type="checkbox"> Travelling Allowance (‚Ç±30)</label>
        </div>

        <!-- INSTALLMENT INFO DISPLAY -->
        <div id="installmentNote" class="installment-note" style="display:none;">
          Installment Month: <span id="installmentValue">‚Äì</span>
        </div>

        <div id="memberInfo" class="info muted">
          Enter AF No and tab/click away to load member details.
        </div>

        <div class="actions">
          <button type="submit" class="btn primary">üíæ Save Collection</button>
          <button type="button" id="btnReset" class="btn ghost">Reset</button>
        </div>

        <div class="actions" style="margin-top:8px">
          <button type="button" id="btnBack" class="btn" onclick="window.location.href='index.html'">
            ‚Üê Back to Menu
          </button>
        </div>
      </form>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Small UI-only script to auto-set Amount for Membership vs Regular -->
  <script>
    (function () {
      const paymentFor = document.getElementById('payment_for');
      const deduct = document.getElementById('deduct_now');
      const amount = document.getElementById('amount');
      const amountNote = document.getElementById('amountNote');
      const orNo = document.getElementById('or_no');

      function updateAmountUI() {
        const isMembership = paymentFor.value === 'membership';
        if (orNo) {
          orNo.disabled = false;
          orNo.readOnly = false;
        }

        if (isMembership) {
          commissionChecks.style.display = 'none';
          const val = 500;
          amount.value = val.toFixed(2);
          amount.readOnly = true;
          amountNote.style.display = 'block';
          amountNote.textContent = deduct.checked
            ? 'Membership (Deduct): ‚Ç±500 recorded ‚Äî agent keeps ‚Ç±150 outright.'
            : 'Membership (No Deduct): ‚Ç±500 recorded ‚Äî ‚Ç±150 added to monthly commission.';
        } else {
          amount.readOnly = false;
          amountNote.style.display = 'none';
          commissionChecks.style.display = 'flex';
        }
      }

      paymentFor.addEventListener('change', updateAmountUI);
      deduct.addEventListener('change', updateAmountUI);
      document.addEventListener('DOMContentLoaded', updateAmountUI);
    })();
  </script>

  <script src="./add_collection.js"></script>
</body>

</html>