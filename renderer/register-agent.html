<!doctype html>
<html lang="en">

<head>

  <meta charset="utf-8" />
  <title>Register Agent ‚Äî Maharlikan AssuredLife</title>
  <link rel="stylesheet" href="./styles.css" />

  <style>
    /* ===== PAGE STRUCTURE ===== */
    #reg-agent-page {
      padding: 24px;
      overflow-y: auto;
      max-height: 100vh;
    }

    #reg-agent-page .card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .12);
      max-width: 1100px;
      margin: 0 auto;
    }

    #reg-agent-page .content {
      padding: 20px;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .banner {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .banner img {
      width: 120px;
      height: auto;
    }

    h1 {
      font-size: 22px;
      font-weight: 700;
      color: #0b1f3a;
      margin: 0 0 4px;
    }

    .muted {
      color: #334155;
    }

    .home-btn {
      background: #0b4d87;
      color: #fff;
      border: 0;
      border-radius: 8px;
      padding: 8px 14px;
      font-weight: 600;
      cursor: pointer;
      transition: filter .2s ease;
    }

    .home-btn:hover {
      filter: brightness(0.95);
    }

    .wrap {
      display: grid;
      gap: 16px;
      grid-template-columns: 1fr;
      overflow-y: auto;
    }

    .section {
      border: 1px solid #d0d7e2;
      border-radius: 12px;
      background: #fff;
      padding: 14px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, .05);
      overflow-y: auto;
      max-height: 420px;
    }

    .section h3 {
      margin: 0 0 12px;
      font-size: 16px;
      font-weight: 700;
      color: #0b4d87;
      border-left: 4px solid #0b4d87;
      padding-left: 8px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(220px, 1fr));
      gap: 10px 14px;
    }

    .full {
      grid-column: 1 / -1;
    }

    label {
      font-size: 13px;
      color: #334155;
      display: block;
      margin-bottom: 6px;
    }

    input,
    select,
    textarea {
      width: 100%;
      height: 38px;
      border-radius: 8px;
      border: 1px solid #d0d7e2;
      padding: 0 10px;
      font-size: 14px;
      background: #fff;
      color: #0f172a;
      transition: all 0.2s ease;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #0b4d87;
      box-shadow: 0 0 0 3px rgba(11, 77, 135, .15);
    }

    textarea {
      min-height: 90px;
      padding: 10px;
      resize: vertical;
    }

    .password-wrapper {
      position: relative;
    }

    .toggle-pass {
      position: absolute;
      right: 10px;
      top: 8px;
      cursor: pointer;
      font-size: 14px;
      color: #0b4d87;
      user-select: none;
    }

    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .btn {
      height: 38px;
      padding: 0 14px;
      border-radius: 8px;
      border: 0;
      cursor: pointer;
      background: #0b4d87;
      color: #fff;
      font-weight: 600;
      transition: filter .2s ease;
    }

    .btn:hover {
      filter: brightness(0.95);
    }

    .btn.secondary {
      background: #28a745;
    }

    .btn.tertiary {
      background: #ff9800;
    }

    .btn.danger {
      background: #e53935;
    }

    .section::-webkit-scrollbar {
      width: 10px;
    }

    .section::-webkit-scrollbar-track {
      background: #eef3f8;
      border-radius: 10px;
    }

    .section::-webkit-scrollbar-thumb {
      background: #0b4d87;
      border-radius: 10px;
    }

    .section::-webkit-scrollbar-thumb:hover {
      background: #0a3f70;
    }

    .splash {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, .15);
      z-index: 99999;
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s ease;
    }

    .splash.show {
      opacity: 1;
      pointer-events: auto;
    }

    .splash-box {
      min-width: 320px;
      max-width: 560px;
      padding: 18px 20px;
      border-radius: 14px;
      color: #fff;
      background: #28a745;
      box-shadow: 0 20px 60px rgba(0, 0, 0, .25);
      transform: scale(.96);
      transition: transform .25s ease;
      text-align: center;
    }

    .splash.show .splash-box {
      transform: scale(1);
    }

    .splash.error .splash-box {
      background: #e53935;
    }

    .splash h4 {
      margin: 0 0 6px;
      font-size: 18px;
    }

    .splash p {
      margin: 0;
      opacity: .95;
    }

    @media (max-width:860px) {
      .grid {
        grid-template-columns: 1fr;
      }

      .section {
        max-height: none;
      }
    }
  </style>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- bcryptjs -->
  <script src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script>

  <!-- Initialize Supabase -->
  <!-- Supabase initialization moved to register-agent.js -->

  <!-- Page JS -->
  <script defer src="./register-agent.js"></script>
</head>

<body>
  <div id="reg-agent-page" class="page">
    <div class="card">
      <div class="content">
        <div class="header">
          <div class="banner">
            <img src="../assets/logo-watermark.png" alt="Maharlikan Logo" />
            <div>
              <h1>Register Agent</h1>
              <div class="muted">Create, link, and manage agent accounts</div>
            </div>
          </div>
          <button class="home-btn" onclick="window.location.href='index.html'">üè† Home</button>
        </div>

        <div class="wrap">
          <!-- ================= NEW AGENT ================= -->
          <div class="section">
            <h3>New Agent & Account</h3>
            <div class="grid">
              <div><label>Last Name</label><input id="na-lastname" /></div>
              <div><label>First Name</label><input id="na-firstname" /></div>
              <div><label>Middle Name</label><input id="na-middlename" /></div>
              <div class="full"><label>Address</label><textarea id="na-address"></textarea></div>
              <div><label>Birthdate</label><input type="date" id="na-birthdate" /></div>
              <div><label>Position</label><input id="na-position" placeholder="Agent / Admin / etc." /></div>
              <div><label>Username</label><input id="na-username" /></div>
              <div><label>Role</label>
                <select id="na-role">
                  <option value="agent">Agent</option>
                  <option value="admin">Admin</option>
                </select>
              </div>

              <!-- ‚úÖ NEW HEAD AGENT FIELD -->
              <div class="full">
                <label>Head Agent</label>
                <select id="na-parent">
                  <option value="">None</option>
                </select>
                <small class="muted">Select the superior or head of this agent (leave blank if top-level).</small>
              </div>

              <div class="password-wrapper">
                <label>Password</label>
                <input type="password" id="na-password" />
                <span class="toggle-pass" onclick="togglePass('na-password', this)">üëÅÔ∏è</span>
              </div>
              <div class="password-wrapper">
                <label>Confirm Password</label>
                <input type="password" id="na-confirm" />
                <span class="toggle-pass" onclick="togglePass('na-confirm', this)">üëÅÔ∏è</span>
              </div>
            </div>
            <div class="row"><button id="btnCreateNew" class="btn secondary">Create Agent & Account</button></div>
          </div>

          <!-- ================= EXISTING AGENT ================= -->
          <div class="section">
            <h3>Attach Account to Existing Agent</h3>
            <div class="grid">
              <div class="full"><label>Choose Agent</label><select id="ex-agent"></select></div>
              <div><label>Username</label><input id="ex-username" /></div>
              <div><label>Role</label>
                <select id="ex-role">
                  <option value="agent">Agent</option>
                  <option value="admin">Admin</option>
                </select>
              </div>
              <div class="password-wrapper">
                <label>Password</label>
                <input type="password" id="ex-password" />
                <span class="toggle-pass" onclick="togglePass('ex-password', this)">üëÅÔ∏è</span>
              </div>
              <div class="password-wrapper">
                <label>Confirm Password</label>
                <input type="password" id="ex-confirm" />
                <span class="toggle-pass" onclick="togglePass('ex-confirm', this)">üëÅÔ∏è</span>
              </div>
            </div>
            <div class="row"><button id="btnAttachAccount" class="btn">Create Account for Agent</button></div>
          </div>

          <!-- ================= RESET PASSWORD ================= -->
          <div class="section">
            <h3>Reset Password</h3>
            <div class="grid">
              <div class="full"><label>Choose Existing Account</label><select id="rp-account"></select></div>
              <div class="password-wrapper">
                <label>New Password</label>
                <input type="password" id="rp-password" />
                <span class="toggle-pass" onclick="togglePass('rp-password', this)">üëÅÔ∏è</span>
              </div>
              <div class="password-wrapper">
                <label>Confirm Password</label>
                <input type="password" id="rp-confirm" />
                <span class="toggle-pass" onclick="togglePass('rp-confirm', this)">üëÅÔ∏è</span>
              </div>
            </div>
            <div class="row"><button id="btnResetPassword" class="btn danger">Reset Password</button></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Splash for Success/Error -->
  <div id="splash" class="splash">
    <div class="splash-box">
      <h4 id="splashTitle"></h4>
      <p id="splashMsg"></p>
    </div>
  </div>

  <script>
    function togglePass(id, el) {
      const input = document.getElementById(id);
      if (!input) return;
      input.type = input.type === "password" ? "text" : "password";
      el.textContent = input.type === "password" ? "üëÅÔ∏è" : "üôà";
    }
  </script>
</body>

</html>