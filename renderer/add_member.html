<!doctype html>
<html>

<head>

  <meta charset="utf-8" />

  <title>New Member · Maharlikan Admin</title>

  <!-- CSP must allow Supabase network + CDN scripts -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: blob: filesystem:;
                 img-src 'self' data: blob: file:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.jsdelivr.net;
                 connect-src 'self' https://*.supabase.co https://*.supabase.in https://api.supabase.com blob:;">

  <!-- Supabase SDK -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="./styles.css" />
  <link rel="stylesheet" href="./styles.css" />
  <!-- Inline styles removed. Global theme applies via styles.css -->
  <style>
    /* Suggestions Dropdown */
    .suggestions-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(20, 22, 28, 0.95);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      margin-top: 4px;
      z-index: 1000;
      max-height: 200px;
      overflow-y: auto;
      backdrop-filter: blur(20px);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }

    .suggestion-item {
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      transition: background 0.2s;
      color: var(--text-main);
      font-size: 0.95rem;
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    .suggestion-item:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--neon-accent);
    }

    .hidden {
      display: none !important;
    }

    /* Toast Notification Styles */
    #toast {
      position: fixed;
      top: 20px;
      right: 20px;
      min-width: 300px;
      max-width: 500px;
      padding: 16px 20px;
      background: rgba(11, 12, 16, 0.95);
      border-left: 4px solid #2196F3;
      border-radius: 8px;
      color: white;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transform: translateX(120%);
      transition: transform 0.3s ease, opacity 0.3s ease;
      opacity: 0;
      z-index: 10000;
      pointer-events: none;
    }

    #toast.show {
      transform: translateX(0);
      opacity: 1;
      pointer-events: auto;
    }

    #toast.success {
      border-left-color: #4CAF50;
      background: rgba(76, 175, 80, 0.15);
    }

    #toast.error {
      border-left-color: #f44336;
      background: rgba(244, 67, 54, 0.15);
    }

    #toast.info {
      border-left-color: #2196F3;
      background: rgba(33, 150, 243, 0.15);
    }

    /* Inline Validation Styles */
    .field-error {
      border-color: #f44336 !important;
      box-shadow: 0 0 0 2px rgba(244, 67, 54, 0.2) !important;
    }

    .error-message {
      display: block;
      color: #f44336;
      font-size: 12px;
      margin-top: 4px;
      margin-bottom: 8px;
    }
  </style>
</head>

<body>
  <div class="page">
    <!-- Brand side -->
    <aside class="brand">
      <img src="../assets/logo-watermark.png" alt="Maharlikan">
      <h1>Maharlikan Mortuary Care Services</h1>
      <p>New Member · Office Use Only</p>
    </aside>

    <!-- Form card -->
    <main class="card">
      <h2>New Member</h2>
      <p id="formMsg" class="muted" aria-live="polite"></p>

      <form id="memberForm" class="grid" novalidate>
        <!-- Basic Info -->
        <div class="col-12 section-title">Member Information</div>
        <div class="col-12 hr"></div>

        <div class="col-4">
          <label>AF No</label>
          <input name="maf_no" autocomplete="off">
          <div data-err="maf_no" class="error"></div>
        </div>

        <div class="col-4">
          <label>Last Name</label>
          <input name="last_name" autocomplete="off">
          <div data-err="last_name" class="error"></div>
        </div>
        <div class="col-4">
          <label>First Name</label>
          <input name="first_name" autocomplete="off">
          <div data-err="first_name" class="error"></div>
        </div>
        <div class="col-4">
          <label>Middle Name</label>
          <input name="middle_name" autocomplete="off">
        </div>

        <div class="col-4">
          <label>Birthdate</label>
          <input type="date" name="birth_date">
          <div data-err="birth_date" class="error"></div>
        </div>
        <div class="col-2">
          <label>Age</label>
          <input type="number" name="age" min="0">
          <div data-err="age" class="error"></div>
        </div>
        <div class="col-2">
          <label>Height</label>
          <input name="height" autocomplete="off">
        </div>
        <div class="col-2">
          <label>Weight</label>
          <input name="weight" autocomplete="off">
        </div>
        <div class="col-2">
          <label>Gender</label>
          <select name="gender">
            <option value="">--</option>
            <option>Male</option>
            <option>Female</option>
          </select>
        </div>

        <div class="col-6">
          <label>Birthplace</label>
          <input name="birthplace" autocomplete="off">
        </div>
        <div class="col-6">
          <label>Contact Number</label>
          <input name="phone_number" autocomplete="off">
        </div>

        <div class="col-4">
          <label>Religion</label>
          <input name="religion">
        </div>
        <div class="col-4">
          <label>Civil Status</label>
          <select name="civil_status">
            <option value="">--</option>
            <option>Single</option>
            <option>Married</option>
            <option>Widower</option>
            <option>Widow</option>
            <option>Separated</option>
            <option>Divorced</option>
            <option>Annulled</option>
          </select>
        </div>
        <div class="col-4">
          <label>Nationality</label>
          <input name="nationality">
        </div>

        <div class="col-12">
          <label>Address</label>
          <textarea name="address"></textarea>
        </div>

        <div class="col-4">
          <label>Zipcode</label>
          <input name="zipcode">
        </div>
        <div class="col-4">
          <label>Occupation</label>
          <input name="occupation">
        </div>

        <!-- Membership -->
        <div class="col-4">
          <label>Membership</label>
          <select name="membership">
            <option value="">-- Select --</option>
            <option>Insurable</option>
            <option>Non-Insurable</option>
          </select>
          <div data-err="membership" class="error"></div>
        </div>

        <!-- Payment Frequency -->
        <div class="col-4">
          <label>Payment Frequency</label>
          <select id="paymentFrequency" name="payment_frequency">
            <option value="Monthly">Monthly (1mo)</option>
            <option value="Quarterly">Quarterly (3mos)</option>
            <option value="Bi-annually">Bi-annually (6mos)</option>
            <option value="Annually">Annually (12mos)</option>
          </select>
          <div data-err="payment_frequency" class="error"></div>
        </div>

        <!-- Plan Type (already present) -->
        <div class="col-4" style="position:relative;">
          <label>Package Type</label>
          <input id="planType" name="plan_type" autocomplete="off">
          <div id="planSuggestions" class="suggestions-list hidden"></div>
          <div data-err="plan_type" class="error"></div>
        </div>

        <!-- Casket Type -->
        <div class="col-4">
          <label> Casket Type </label>
          <input id="casketType" name="casket_type" readonly>
          <div data-err="casket_type" class="error"></div>
        </div>

        <!-- Contracted Price -->
        <div class="col-4">
          <label>Contracted Price</label>
          <input id="contractedPrice" type="number" step="0.01" name="contracted_price" readonly>
          <div data-err="contracted_price" class="error"></div>
        </div>

        <!-- Monthly Due -->
        <div class="col-4">
          <label>Monthly Due</label>
          <input id="monthlyDue" type="number" step="0.01" name="monthly_due" readonly>
          <div data-err="monthly_due" class="error"></div>
        </div>

        <!-- Date Joined -->
        <div class="col-4">
          <label>Date Joined</label>
          <input type="date" name="date_joined">
          <div data-err="date_joined" class="error"></div>
        </div>

        <!-- Agent -->
        <div class="col-4">
          <label>Agent</label>
          <select id="agentSelect" name="agent_id">
            <option value="">Select Agent</option>
          </select>
          <div data-err="agent" class="error"></div>
        </div>

        <!-- Beneficiaries -->
        <div class="col-12 section-title">Beneficiaries</div>
        <div class="col-12 hr"></div>

        <div class="col-12" id="beneList"></div>
        <div class="col-12 actions">
          <button class="btn secondary" type="button" id="addBeneBtn">+ Add Beneficiary</button>
        </div>

        <div class="col-12 actions">
          <button class="btn" id="saveBtn" type="submit">Save Member</button>
          <a class="btn secondary" href="./index.html">Back to Menu</a>
        </div>
      </form>
    </main>
  </div>

  <!-- Toast Notification Container -->
  <div id="toast" role="alert" aria-live="assertive"></div>

  <script src="../dist/supabase.js"></script>
  <script src="add_member.js"></script>
</body>

</html>